@inject NavigationManager Navigation

<MudSelect T="string"
           Value="@_currentCulture"
           ValueChanged="OnCultureChanged"
           Variant="Variant.Text"
           Margin="Margin.Dense"
           Dense="true"
           Style="color: white; min-width: 120px;"
           Class="ml-auto">
    <MudSelectItem Value="@("en")">English</MudSelectItem>
    <MudSelectItem Value="@("zh-TW")">繁體中文</MudSelectItem>
</MudSelect>

@code {
    private string _currentCulture = CultureInfo.CurrentUICulture.Name;

    private void OnCultureChanged(string culture)
    {
        if (culture == _currentCulture) return;

        var uri = new Uri(Navigation.Uri)
            .GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var encodedCulture = Uri.EscapeDataString(culture);
        var encodedRedirect = Uri.EscapeDataString("/" + uri.TrimStart('/'));

        Navigation.NavigateTo(
            $"/api/set-culture?culture={encodedCulture}&redirectUri={encodedRedirect}",
            forceLoad: true);
    }
}
