@inject IStringLocalizer<SharedResource> L

<MudPaper Class="pa-3" Outlined="true">
    <MudText Typo="Typo.caption" Class="mb-2" Style="display:inline-flex;align-items:center;gap:4px;">
        @Label
        <HelpIcon Text="@HelpText" />
    </MudText>

    @if (Items is not null && Items.Count > 0)
    {
        @for (var i = 0; i < Items.Count; i++)
        {
            var index = i;
            <MudStack Row="true" AlignItems="AlignItems.Center" Class="mb-1" Spacing="1">
                <MudTextField T="string"
                              Value="Items[index]"
                              ValueChanged="v => OnItemChanged(index, v)"
                              Placeholder="@Placeholder"
                              Variant="Variant.Outlined"
                              Margin="Margin.Dense"
                              Required="true"
                              RequiredError="@L["ListEditor_Required"]"
                              Class="flex-grow-1" />
                <MudIconButton Icon="@Icons.Material.Filled.Delete"
                               Color="Color.Error"
                               Size="Size.Small"
                               OnClick="() => RemoveItem(index)" />
            </MudStack>
        }
    }
    else
    {
        <MudText Typo="Typo.body2" Class="mud-text-secondary mb-2">@L["ListEditor_Empty"]</MudText>
    }

    <MudButton Variant="Variant.Text"
               Color="Color.Primary"
               StartIcon="@Icons.Material.Filled.Add"
               OnClick="AddItem"
               Size="Size.Small">
        @L["Btn_Add"]
    </MudButton>
</MudPaper>

@code {
    [Parameter] public List<string>? Items { get; set; }
    [Parameter] public EventCallback<List<string>?> ItemsChanged { get; set; }
    [Parameter] public string Label { get; set; } = string.Empty;
    [Parameter] public string? Placeholder { get; set; }
    [Parameter] public string? HelpText { get; set; }

    private async Task OnItemChanged(int index, string value)
    {
        if (Items is null) return;
        Items[index] = value;
        await ItemsChanged.InvokeAsync(Items);
    }

    private async Task AddItem()
    {
        Items ??= [];
        Items.Add(string.Empty);
        await ItemsChanged.InvokeAsync(Items);
    }

    private async Task RemoveItem(int index)
    {
        if (Items is null) return;
        Items.RemoveAt(index);
        await ItemsChanged.InvokeAsync(Items.Count == 0 ? null : Items);
    }
}
